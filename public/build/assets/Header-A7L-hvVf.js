import{A as ue,s as p,p as B,i as j,B as ce,C as de,y as ve,c as i,o as l,a as t,j as y,D as R,u as v,t as c,e as M,v as z,z as X,F as P,g as x,h as A,b as L,w as F,d as O,S as J,q as pe,l as _e,n as Y,Q as me}from"./app-B2MXdJvk.js";const ge=ue("cart",()=>{const u=p([]),n=p(!1),r=100;localStorage.getItem("cart")&&(u.value=JSON.parse(localStorage.getItem("cart")));const g=B(()=>u.value.reduce((o,d)=>o+d.quantity,0)),T=B(()=>u.value.reduce((o,d)=>{const b=d.price+(d.withPrinting?r:0);return o+b*d.quantity},0));function U(o,d,b,_,C,D=!1){const Q=u.value.findIndex(N=>N.id===o.id&&N.color===d&&N.size===b&&N.withPrinting===D);Q!==-1?u.value[Q].quantity+=_:u.value.push({id:`${o.id}_${d}_${b}_${D?"with_printing":"without_printing"}`,product_id:o.id,title:o.title,price:o.price,image:C,color:d,size:b,quantity:_,article:o.article,withPrinting:D}),localStorage.setItem("cart",JSON.stringify(u.value))}function $(o){u.value.splice(o,1),localStorage.setItem("cart",JSON.stringify(u.value))}function V(o,d){if(d<=0){$(o);return}u.value[o].quantity=d,localStorage.setItem("cart",JSON.stringify(u.value))}function w(){u.value=[],localStorage.removeItem("cart")}function S(){n.value=!0}function I(){n.value=!1}function q(){n.value=!n.value}function f(o){u.value[o]&&(u.value[o].withPrinting=!u.value[o].withPrinting,localStorage.setItem("cart",JSON.stringify(u.value)))}async function k(o){var d,b;try{const _=await j.post(route("client.cart.store"),o);if(_.data.success)return w(),{success:!0,message:_.data.message}}catch(_){return console.error("Ошибка при отправке заказа:",_),{success:!1,message:((b=(d=_.response)==null?void 0:d.data)==null?void 0:b.message)||"Произошла ошибка при отправке заказа"}}}return{items:u,isOpen:n,totalItems:g,totalPrice:T,addItem:U,removeItem:$,updateQuantity:V,clearCart:w,openCart:S,closeCart:I,toggleCart:q,submitOrder:k,togglePrinting:f,printingCost:r}}),he={class:"header"},fe={class:"row header__top__block__main"},be={class:"container__header"},ye={class:"container__header__flex"},ke={class:""},we={class:"header__top d-flex"},Ce={class:"header__top__block"},Se={class:"header__top__img"},Me={key:0,id:"cart_qty"},Pe={class:"container"},Te={class:"row header__search"},$e={class:"col-xl-8"},Ie={class:"input-group"},qe={class:"input-group-append"},Ne={key:0,class:"search-result-item view-all"},xe={class:"search-results-dropdown"},Oe={key:0,class:"search-loading"},Ve={key:0,class:"no-results"},De={class:"row header__menu"},Be={class:"col-xl-8"},Qe={class:"navbar navbar-expand-lg navbar-light bg-light"},ze={class:"container-fluid header__menu"},Fe={class:"collapse navbar-collapse",id:"navbarNav"},Je={class:"navbar-nav"},Ue={class:"wrap_c"},Re={class:"list"},Ae=["href","onMouseenter"],Le={class:"table"},je={class:"margin"},Ee={style:{"text-transform":"uppercase"}},He={class:"subcategory-column"},Ge=["href","onMouseenter"],Ke=["href"],We={key:0,class:"drawing-dropdown"},Xe={class:"drawing-dropdown-content"},Ye={class:"nav-item"},Ze={class:"nav-item"},et={class:"cart-popup"},tt={class:"cart-popup-header"},st={class:"cart-popup-content"},at={key:0,class:"success-message"},nt={key:1,class:"error-message"},lt={key:2,class:"empty-cart"},ot={key:3},it={class:"cart-item-image"},rt=["src","alt"],ut={class:"cart-item-details"},ct={class:"printing-option"},dt={class:"printing-buttons"},vt=["onClick"],pt=["onClick"],_t={class:"cart-item-price"},mt={class:"cart-item-controls"},gt={class:"quantity-controls"},ht=["onClick"],ft=["onClick"],bt=["onClick"],yt={key:0,class:"cart-popup-footer"},kt={class:"form-group"},wt={class:"form-group"},Ct={class:"form-group"},St={class:"form-group checkbox"},Mt={class:"cart-total"},$t={__name:"Header",props:{categories:Array,drawings:Array},setup(u){const n=ge(),r=ce({name:"",phone:"",email:"",agreedToPrivacy:!1}),g=p(""),T=p("");async function U(){if(console.log("Начало отправки заказа"),g.value="",!r.name){g.value="Введите имя";return}if(!r.phone){g.value="Введите телефон";return}if(!r.email){g.value="Введите email";return}if(!r.agreedToPrivacy){console.log("Нет согласия с политикой"),g.value="Необходимо согласие с политикой конфиденциальности";return}if(!r.name||!r.phone||!r.email){g.value="Заполните все обязательные поля";return}const a={name:r.name,phone:r.phone,email:r.email,agreed_to_privacy:r.agreedToPrivacy,items:n.items.map(e=>({id:e.id,title:e.title,price:e.price,with_printing:e.withPrinting,printing_cost:e.withPrinting?n.printingCost:0,color:e.color,size:e.size,quantity:e.quantity,article:e.article,image:e.image})),total_price:n.totalPrice};try{const e=await n.submitOrder(a);e.success?(T.value=e.message,setTimeout(()=>{Object.assign(r,{name:"",phone:"",email:"",agreedToPrivacy:!1}),n.closeCart(),T.value=""},2e3)):g.value=e.message}catch(e){g.value="Произошла ошибка при отправке заказа",console.error("Ошибка при отправке заказа:",e)}}const $=u,V=p(!1),w=p(null),S=p(null),I=p(null),q=p(!1),f=p(""),k=p([]),o=p(!1),d=p(null),b=p(!1),_=p(!1),C=p([]),D=B(()=>C.value.length>0?C.value:$.drawings||[]);de(()=>$.drawings,a=>{a&&a.length>0&&(C.value=a)},{immediate:!0});const Q=()=>{clearTimeout(I.value),V.value=!0,q.value=!0},N=()=>{I.value=setTimeout(()=>{q.value||(V.value=!1,w.value=null,S.value=null)},300)},Z=()=>{q.value=!0,clearTimeout(I.value)},E=()=>{q.value=!1,N()},ee=a=>{w.value=a,S.value=null},te=a=>{S.value=a},se=a=>{if(!w.value)return[];const e=$.categories.find(h=>h.id===w.value);if(!e||!e.children)return[];const s=e.children.find(h=>h.id===a);return(s==null?void 0:s.children)||[]},H=()=>{clearTimeout(I.value)},ae=()=>{if(clearTimeout(d.value),!f.value.trim()){k.value=[];return}d.value=setTimeout(()=>{ne()},300)},ne=async()=>{if(!f.value.trim()){k.value=[];return}b.value=!0;try{const a=await j.get(route("client.products.search"),{params:{query:f.value}});k.value=a.data}catch(a){console.error("Search error:",a),k.value=[]}finally{b.value=!1}},le=()=>{f.value.trim()&&me.get(route("client.products.search-page"),{query:f.value.trim()})},G=()=>{setTimeout(()=>{o.value=!1},200)},oe=()=>{o.value=!0},ie=async()=>{if(C.value.length>0){_.value=!0;return}try{const a=await j.get(route("client.drawing.list"));C.value=a.data,_.value=!0}catch(a){console.error("Failed to fetch drawings",a),C.value=[],_.value=!0}},re=()=>{setTimeout(()=>{_.value=!1},300)};ve(()=>{});function K(a,e){n.items[a].withPrinting!==e&&n.togglePrinting(a)}function W(a){return a.price+(a.withPrinting?n.printingCost:0)}return B(()=>n.items.some(a=>a.withPrinting)),B(()=>n.items.reduce((a,e)=>a+(e.withPrinting?n.printingCost*e.quantity:0),0)),(a,e)=>(l(),i("header",he,[t("div",fe,[t("div",be,[t("div",ye,[t("div",ke,[t("div",we,[e[13]||(e[13]=R('<div class="d-block d-md-none"><a href="tel:+74993943841" class="header__phone">8 (499) 394-38-41</a></div><span class="company">|</span><div class="header__top__block company"><a href="">О компании</a></div><span>|</span><div class="header__top__block"><button type="submit" class="btn btn-primary submit-btn btn__red">ЗАКАЗАТЬ ЗВОНОК</button></div><span>|</span>',6)),t("div",Ce,[t("div",{class:"header__top__cart",onClick:e[0]||(e[0]=s=>v(n).toggleCart())},[t("div",Se,[e[11]||(e[11]=t("img",{src:"/img/cart.png",alt:""},null,-1)),v(n).totalItems>0?(l(),i("span",Me,c(v(n).totalItems),1)):y("",!0)]),e[12]||(e[12]=t("div",{class:"header__top__info"},[t("p",{class:"min__order"},"Минимальный заказ"),t("p",{class:"rub"},"15 0007 Р")],-1))])])])])])])]),t("div",Pe,[t("div",Te,[e[16]||(e[16]=t("div",{class:"col-xl-2"},[t("img",{src:"https://web-ruslan.ru/img/logo.png",alt:"logo"})],-1)),t("div",$e,[e[15]||(e[15]=t("button",{class:"navbar-toggler ds-mob",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarNav","aria-controls":"navbarNav","aria-expanded":"false","aria-label":"Toggle navigation"},[t("span",{class:"navbar-toggler-icon"})],-1)),t("div",Ie,[M(t("input",{type:"text",class:"form-control",placeholder:"Поиск товаров по названию или артикулу","onUpdate:modelValue":e[1]||(e[1]=s=>f.value=s),onInput:ae,onFocus:e[2]||(e[2]=s=>o.value=!0),onBlur:G},null,544),[[z,f.value]]),t("div",qe,[t("button",{class:"btn btn-secondary",type:"button",onClick:e[3]||(e[3]=(...s)=>a.submitSearch&&a.submitSearch(...s))},e[14]||(e[14]=[t("img",{src:"https://web-ruslan.ru/img/ser.png",alt:"search"},null,-1)]))]),M(t("div",{class:"search-results-dropdown",onMouseenter:oe,onMouseleave:G},[(l(!0),i(P,null,x(k.value,s=>(l(),i("div",{class:"search-result-item",key:s.id},[L(v(J),{href:a.route("client.products.show",s.url)},{default:F(()=>[O(c(s.title)+" ("+c(s.article)+") ",1)]),_:2},1032,["href"])]))),128)),f.value?(l(),i("div",Ne,[t("a",{href:"#",onClick:A(le,["prevent"])},' Все результаты по запросу "'+c(f.value)+'" ',1)])):y("",!0)],544),[[X,o.value&&k.value.length>0]]),M(t("div",xe,[b.value?(l(),i("div",Oe," Загрузка... ")):(l(),i(P,{key:1},[k.value.length===0&&f.value?(l(),i("div",Ve," Ничего не найдено ")):y("",!0)],64))],512),[[X,o.value]])])]),e[17]||(e[17]=R('<div class="col-xl-2 phone__mob__none"><span><a href="">8 (499) 394 38 41</a></span></div><div class="catalogmobile__my"><div class="nav-item catalog"><a class="nav-link" href="#">КАТАЛОГ</a><span></span></div></div>',2))]),t("div",De,[e[28]||(e[28]=t("div",{class:"col-xl-2"},null,-1)),t("div",Be,[t("nav",Qe,[t("div",ze,[t("div",Fe,[t("ul",Je,[t("li",{class:"nav-item catal catalog__desc",onMouseenter:Q,onMouseleave:E},[e[18]||(e[18]=t("a",{class:"nav-link catalog__mar",href:"#"},"КАТАЛОГ",-1)),e[19]||(e[19]=t("span",null,null,-1)),V.value?(l(),i("section",{key:0,class:"catalog_drop",onMouseenter:Z,onMouseleave:E},[t("div",Ue,[t("div",Re,[(l(!0),i(P,null,x(u.categories,s=>{var h;return l(),i("a",{href:`/categories/${s.url}/products`,class:"item",key:s.id,onMouseenter:m=>ee(s.id)},[t("div",Le,[t("div",je,[t("p",Ee,c(s.title),1)])]),w.value===s.id&&((h=s.children)!=null&&h.length)?(l(),i("div",{key:0,class:"subcategories",onMouseenter:H},[t("div",He,[(l(!0),i(P,null,x(s.children,m=>(l(),i("a",{key:m.id,href:`/categories/${m.url}/products`,onMouseenter:Pt=>te(m.id)},c(m.title),41,Ge))),128))]),S.value?(l(),i("div",{key:0,class:"sub-subcategories",onMouseenter:H},[(l(!0),i(P,null,x(se(S.value),m=>(l(),i("div",{key:m.id},[t("a",{href:`/catalog/${m.url}/`},c(m.title),9,Ke)]))),128))],32)):y("",!0)],32)):y("",!0)],40,Ae)}),128))])])],32)):y("",!0)],32),e[24]||(e[24]=t("li",{class:"nav-item"},[t("a",{class:"nav-link",href:"/drawing/tampopechat"},"ПОРТФОЛИО")],-1)),t("li",{class:"nav-item drawing-menu",onMouseenter:ie,onMouseleave:re},[e[20]||(e[20]=t("a",{class:"nav-link",href:"#"},"НАНЕСЕНИЕ",-1)),e[21]||(e[21]=t("span",null,null,-1)),_.value?(l(),i("div",We,[t("div",Xe,[(l(!0),i(P,null,x(D.value,s=>(l(),_e(v(J),{key:s.id,href:a.route("client.drawing.show",s.url),class:"drawing-dropdown-item"},{default:F(()=>[O(c(s.title),1)]),_:2},1032,["href"]))),128))])])):y("",!0)],32),t("li",Ye,[L(v(J),{class:"nav-link",href:a.route("client.contacts.index")},{default:F(()=>e[22]||(e[22]=[O("КОНТАКТЫ")])),_:1,__:[22]},8,["href"])]),e[25]||(e[25]=t("li",{class:"nav-item"},[t("a",{class:"nav-link",href:"/news"},"НОВОСТИ")],-1)),t("li",Ze,[L(v(J),{class:"nav-link",href:a.route("client.payment-delivery.index")},{default:F(()=>e[23]||(e[23]=[O("ОПЛАТА И ДОСТАВКА")])),_:1,__:[23]},8,["href"])]),e[26]||(e[26]=R('<li class="nav-item nav__block__none"><a class="more_menu nav-link" href="#">Преимущества</a></li><li class="nav-item nav__block__none"><a class="more_menu nav-link" href="#">Награды</a></li><li class="nav-item nav__block__none"><a class="more_menu nav-link" href="#">Благодарности</a></li><li class="nav-item nav__block__none"><a class="more_menu nav-link" href="#">Новости</a></li><li class="nav-item nav__block__none"><a class="more_menu nav-link" href="#">Статьи</a></li><li class="nav-item nav__block__none"><a class="more_menu nav-link" href="#">Вопросы и ответы</a></li><li class="nav-item nav__block__none menu__phone"><a class="nav-link" href="#">8 (499) 394 38 41</a></li><li class="nav-item nav__block__none"><a class="nav-link menu__email" href="#">info@mvgifts.ru</a></li>',8))]),e[27]||(e[27]=t("button",{class:"btn-close d-lg-none ms-auto",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarNav","aria-controls":"navbarNav","aria-label":"Close"},null,-1))])])])]),e[29]||(e[29]=t("div",{class:"col-xl-2"},null,-1))])]),v(n).isOpen?(l(),i("div",{key:0,class:"cart-popup-overlay",onClick:e[10]||(e[10]=A(s=>v(n).closeCart(),["self"]))},[t("div",et,[t("div",tt,[e[30]||(e[30]=t("h3",null,"Корзина",-1)),t("button",{class:"close-cart",onClick:e[4]||(e[4]=s=>v(n).closeCart())},"×")]),t("div",st,[T.value?(l(),i("div",at,c(T.value),1)):y("",!0),g.value?(l(),i("div",nt,[O(c(g.value)+" ",1),t("button",{class:"error-close",onClick:e[5]||(e[5]=s=>g.value="")},"×")])):y("",!0),v(n).items.length===0?(l(),i("div",lt," Корзина пуста ")):(l(),i("div",ot,[(l(!0),i(P,null,x(v(n).items,(s,h)=>(l(),i("div",{key:h,class:"cart-item"},[t("div",it,[t("img",{src:s.image,alt:s.title},null,8,rt)]),t("div",ut,[t("h4",null,c(s.title),1),t("p",null,"Цвет: "+c(s.color)+", Размер: "+c(s.size),1),t("p",null,"Артикул: "+c(s.article),1),t("div",ct,[t("div",dt,[t("button",{class:Y({"printing-btn":!0,active:!s.withPrinting}),onClick:m=>K(h,!1)}," Без нанесения ",10,vt),t("button",{class:Y({"printing-btn":!0,active:s.withPrinting}),onClick:m=>K(h,!0)}," С нанесением (+ "+c(v(n).printingCost)+" ₽) ",11,pt)])]),t("div",_t,c(W(s))+" ₽ × "+c(s.quantity)+" = "+c(W(s)*s.quantity)+" ₽ ",1)]),t("div",mt,[t("div",gt,[t("button",{onClick:m=>v(n).updateQuantity(h,s.quantity-1)},"-",8,ht),t("span",null,c(s.quantity),1),t("button",{onClick:m=>v(n).updateQuantity(h,s.quantity+1)},"+",8,ft)]),t("button",{class:"remove-item",onClick:m=>v(n).removeItem(h)},"Удалить",8,bt)])]))),128))]))]),v(n).items.length>0?(l(),i("div",yt,[t("form",{onSubmit:A(U,["prevent"]),class:"order-form"},[t("div",kt,[e[31]||(e[31]=t("label",{for:"name"},null,-1)),M(t("input",{type:"text",id:"name","onUpdate:modelValue":e[6]||(e[6]=s=>r.name=s),placeholder:"Ваше имя"},null,512),[[z,r.name]])]),t("div",wt,[e[32]||(e[32]=t("label",{for:"phone"},null,-1)),M(t("input",{type:"tel",id:"phone","onUpdate:modelValue":e[7]||(e[7]=s=>r.phone=s),placeholder:"+7 (999) 999-99-99"},null,512),[[z,r.phone]])]),t("div",Ct,[e[33]||(e[33]=t("label",{for:"email"},null,-1)),M(t("input",{type:"email",id:"email","onUpdate:modelValue":e[8]||(e[8]=s=>r.email=s),placeholder:"your@email.com"},null,512),[[z,r.email]])]),t("div",St,[M(t("input",{type:"checkbox",id:"privacy","onUpdate:modelValue":e[9]||(e[9]=s=>r.agreedToPrivacy=s)},null,512),[[pe,r.agreedToPrivacy]]),e[34]||(e[34]=t("label",{for:"privacy"},[O(" Я согласен с "),t("a",{style:{"text-decoration":"underline"},href:"/privacy-policy",target:"_blank"},"политикой конфиденциальности")],-1))]),t("div",Mt," Общая сумма: "+c(v(n).totalPrice)+" Р ",1),e[35]||(e[35]=t("button",{type:"submit",class:"btn btn-primary submit-btn btn__red"}," Оформить заказ ",-1))],32)])):y("",!0)])])):y("",!0)]))}};export{$t as _,ge as u};
