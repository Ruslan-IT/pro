import{S as _,r as p,c as u,o as n,a as s,b as g,w as P,j as f,F as v,g as I,n as V,t as i}from"./app-QOUyzO7S.js";import{_ as k}from"./_plugin-vue_export-helper-DlAUqK2U.js";const b={name:"ProductItem",components:{Link:_},props:{product:{type:Object,required:!0,validator:t=>t&&t.id&&t.title}},data(){return{currentImageKey:0,activeVariant:null}},computed:{currentProduct(){return this.activeVariant||this.product},currentStock(){return this.currentProduct.total||0},currentWarehouse(){return this.currentProduct.sklad||"Москва"},currentArticle(){return this.currentProduct.article||""},shortProductName(){const t=this.currentProduct.title.indexOf(",");return t>0?this.currentProduct.title.substring(0,t).trim():this.currentProduct.title},currentImageUrl(){const t=this.currentProduct.url_img||this.currentProduct.photo;if(t&&t!=="1")return this.ensureImageUrl(t);const e=this.currentProduct.sid,c=this.currentProduct.tovar_id||this.currentProduct.id_parent||this.currentProduct.id;return e&&c?`https://mvgifts.ru/img/tovars/${e}/${c}/${c}.jpg`:"https://via.placeholder.com/200?text=No+Image"},hasVariants(){return this.product.variants&&this.product.variants.length>0},uniqueColorVariants(){if(!this.hasVariants)return[];const t=[...this.product.variants];this.product.color&&t.unshift({...this.product,isMain:!0});const e=new Map;return t.forEach(c=>{c.color&&!e.has(c.color)&&e.set(c.color,c)}),Array.from(e.values())}},methods:{getVariantImage(t){const e=t.photo||t.url_img;if(e&&e!=="1")return this.ensureImageUrl(e);const c=t.sid||this.product.sid,a=t.tovar_id||t.id_parent||t.id;return c&&a?`https://mvgifts.ru/img/tovars/${c}/${a}/${a}.jpg`:"https://via.placeholder.com/40?text=No+Img"},setCurrentProduct(t){this.activeVariant=this.prepareVariantData(t),this.currentImageKey+=1},resetToMainProduct(){this.activeVariant=null,this.currentImageKey+=1},ensureImageUrl(t){return t?t.startsWith("http")?t:`https://mvgifts.ru${t.startsWith("/")?"":"/"}${t}`:""},prepareVariantData(t){return{...t,sid:t.sid||this.product.sid,tovar_id:t.tovar_id||t.id_parent||t.id,url_img:t.photo||t.url_img||this.product.url_img}}},watch:{product:{handler(){this.activeVariant=null,this.currentImageKey+=1},deep:!0}}},x={class:"product-card"},y={class:"block__img__cart"},w=["src","width","height","alt"],C={class:"product__cart__block"},M={key:0,class:"thumbnail-variants"},N={class:"thumbnails-container"},U=["src","onMouseover","alt","title"],S=["title"],K={class:"product-sku"},j={class:"product-stock"},L={class:"product-warehouse"},W={class:"product-footer"},q={class:"product-price"};function A(t,e,c,a,d,r){const l=p("Link");return n(),u("div",x,[s("div",y,[g(l,{href:t.route("client.products.show",{product:c.product.url})},{default:P(()=>[(n(),u("img",{src:r.currentImageUrl,width:r.currentProduct.width||"200px",height:r.currentProduct.height||"200px",alt:r.currentProduct.title,class:"product-main-image",key:d.currentImageKey},null,8,w))]),_:1},8,["href"])]),s("div",C,[r.hasVariants?(n(),u("div",M,[s("div",N,[(n(!0),u(v,null,I(r.uniqueColorVariants,(o,h)=>(n(),u("img",{key:`variant-${h}`,src:r.getVariantImage(o),class:V(["thumbnail-image",{"active-thumbnail":r.currentProduct.id===o.id}]),onMouseover:m=>r.setCurrentProduct(o),onMouseout:e[0]||(e[0]=m=>r.resetToMainProduct()),alt:o.title,title:o.color},null,42,U))),128))])])):f("",!0),s("div",{class:"product-name",title:r.currentProduct.title},i(r.shortProductName),9,S),s("div",K,"Артикул: 0"+i(r.currentProduct.sid)+" - "+i(r.currentArticle),1),s("div",j," Остаток: "+i(r.currentStock>0?r.currentStock+" шт.":"по запросу"),1),s("div",L,"Склад: "+i(r.currentWarehouse),1),s("div",W,[s("div",q,i(r.currentProduct.price)+" ₽",1),e[1]||(e[1]=s("img",{src:"https://cdn-icons-png.flaticon.com/512/263/263142.png",alt:"Корзина",class:"cart-icon"},null,-1))])])])}const E=k(b,[["render",A],["__scopeId","data-v-c8d78bbe"]]);export{E as P};
