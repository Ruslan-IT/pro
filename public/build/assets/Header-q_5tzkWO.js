import{A as ce,s as m,p as z,i as E,B as de,C as ve,y as ge,c as n,o as a,a as t,j as f,D as j,u as g,t as c,e as q,v as J,z as Z,F as C,g as S,h as U,b as L,w as x,d as V,S as R,q as pe,l as _e,n as ee,Q as me}from"./app-CzakFkXn.js";const he=ce("cart",()=>{const i=m([]),o=m(!1),r=100;localStorage.getItem("cart")&&(i.value=JSON.parse(localStorage.getItem("cart")));const p=z(()=>i.value.reduce((u,v)=>u+v.quantity,0)),k=z(()=>i.value.reduce((u,v)=>{const y=v.price+(v.withPrinting?r:0);return u+y*v.quantity},0));function I(u,v,y,h,$,B=!1){const F=i.value.findIndex(O=>O.id===u.id&&O.color===v&&O.size===y&&O.withPrinting===B);F!==-1?i.value[F].quantity+=h:i.value.push({id:`${u.id}_${v}_${y}_${B?"with_printing":"without_printing"}`,product_id:u.id,title:u.title,price:u.price,image:$,color:v,size:y,quantity:h,article:u.article,withPrinting:B}),localStorage.setItem("cart",JSON.stringify(i.value))}function M(u){i.value.splice(u,1),localStorage.setItem("cart",JSON.stringify(i.value))}function D(u,v){if(v<=0){M(u);return}i.value[u].quantity=v,localStorage.setItem("cart",JSON.stringify(i.value))}function P(){i.value=[],localStorage.removeItem("cart")}function T(){o.value=!0}function N(){o.value=!1}function A(){o.value=!o.value}function b(u){i.value[u]&&(i.value[u].withPrinting=!i.value[u].withPrinting,localStorage.setItem("cart",JSON.stringify(i.value)))}async function w(u){var v,y;try{const h=await E.post(route("client.cart.store"),u);if(h.data.success)return P(),{success:!0,message:h.data.message}}catch(h){return console.error("Ошибка при отправке заказа:",h),{success:!1,message:((y=(v=h.response)==null?void 0:v.data)==null?void 0:y.message)||"Произошла ошибка при отправке заказа"}}}return{items:i,isOpen:o,totalItems:p,totalPrice:k,addItem:I,removeItem:M,updateQuantity:D,clearCart:P,openCart:T,closeCart:N,toggleCart:A,submitOrder:w,togglePrinting:b,printingCost:r}}),fe={class:"header"},be={class:"row header__top__block__main"},ye={class:"container__header"},ke={class:"container__header__flex"},Ce={class:""},we={class:"header__top d-flex"},Se={class:"header__top__block"},Me={class:"header__top__img"},Pe={key:0,id:"cart_qty"},$e={class:"container"},Te={class:"row header__search"},qe={class:"col-xl-8"},Ie={class:"input-group"},Ne={class:"input-group-append"},Ae={key:0,class:"search-result-item view-all"},Oe={class:"search-results-dropdown"},Ve={key:0,class:"search-loading"},De={key:0,class:"no-results"},Be={key:0,class:"mobile-catalog-menu"},Qe={class:"mobile-catalog-list"},ze=["onClick"],Fe={key:0},Je=["href","onClick"],Ue={key:0},xe=["href"],Re={class:"row header__menu"},je={class:"col-xl-8"},Le={class:"navbar navbar-expand-lg navbar-light bg-light"},Ee={class:"container-fluid header__menu"},He={class:"collapse navbar-collapse",id:"navbarNav"},Ge={class:"navbar-nav"},Ke={class:"wrap_c"},We={class:"list"},Xe=["href","onMouseenter"],Ye={class:"table"},Ze={class:"margin"},et={style:{"text-transform":"uppercase"}},tt={class:"subcategory-column"},st=["href","onMouseenter"],lt=["href"],at={key:0,class:"drawing-dropdown"},nt={class:"drawing-dropdown-content"},ot={class:"nav-item"},it={class:"nav-item"},rt={class:"cart-popup"},ut={class:"cart-popup-header"},ct={class:"cart-popup-content"},dt={key:0,class:"success-message"},vt={key:1,class:"error-message"},gt={key:2,class:"empty-cart"},pt={key:3},_t={class:"cart-item-image"},mt=["src","alt"],ht={class:"cart-item-details"},ft={class:"printing-option"},bt={class:"printing-buttons"},yt=["onClick"],kt=["onClick"],Ct={class:"cart-item-price"},wt={class:"cart-item-controls"},St={class:"quantity-controls"},Mt=["onClick"],Pt=["onClick"],$t=["onClick"],Tt={key:0,class:"cart-popup-footer"},qt={class:"form-group"},It={class:"form-group"},Nt={class:"form-group"},At={class:"form-group checkbox"},Ot={class:"cart-total"},Vt={data(){return{showMobileCatalog:!1,mobileActiveCategory:null,mobileActiveSubcategory:null}},methods:{toggleMobileCatalog(){this.showMobileCatalog=!this.showMobileCatalog,this.mobileActiveCategory=null,this.mobileActiveSubcategory=null},toggleMobileSubcategory(i){this.mobileActiveCategory=this.mobileActiveCategory===i?null:i,this.mobileActiveSubcategory=null},toggleMobileSubSubcategory(i){this.mobileActiveSubcategory=this.mobileActiveSubcategory===i?null:i},getSubSubcategories(i){var p;const o=this.categories.find(k=>{var I;return(I=k.children)==null?void 0:I.some(M=>M.id===i)}),r=(p=o==null?void 0:o.children)==null?void 0:p.find(k=>k.id===i);return(r==null?void 0:r.children)||[]}}},Bt=Object.assign(Vt,{__name:"Header",props:{categories:Array,drawings:Array},setup(i){const o=he(),r=de({name:"",phone:"",email:"",agreedToPrivacy:!1}),p=m(""),k=m("");async function I(){if(p.value="",!r.name){p.value="Введите имя";return}if(!r.phone){p.value="Введите телефон";return}if(!r.email){p.value="Введите email";return}if(!r.agreedToPrivacy){console.log("Нет согласия с политикой"),p.value="Необходимо согласие с политикой конфиденциальности";return}if(!r.name||!r.phone||!r.email){p.value="Заполните все обязательные поля";return}const l={name:r.name,phone:r.phone,email:r.email,agreed_to_privacy:r.agreedToPrivacy,items:o.items.map(e=>({id:e.id,title:e.title,price:e.price,with_printing:e.withPrinting,printing_cost:e.withPrinting?o.printingCost:0,color:e.color,size:e.size,quantity:e.quantity,article:e.article,image:e.image})),total_price:o.totalPrice};try{const e=await o.submitOrder(l);e.success?(k.value=e.message,setTimeout(()=>{Object.assign(r,{name:"",phone:"",email:"",agreedToPrivacy:!1}),o.closeCart(),k.value=""},2e3)):p.value=e.message}catch(e){p.value="Произошла ошибка при отправке заказа",console.error("Ошибка при отправке заказа:",e)}}const M=i,D=m(!1),P=m(null),T=m(null),N=m(null),A=m(!1),b=m(""),w=m([]),u=m(!1),v=m(null),y=m(!1),h=m(!1),$=m([]),B=z(()=>$.value.length>0?$.value:M.drawings||[]);ve(()=>M.drawings,l=>{l&&l.length>0&&($.value=l)},{immediate:!0});const F=()=>{clearTimeout(N.value),D.value=!0,A.value=!0},O=()=>{N.value=setTimeout(()=>{A.value||(D.value=!1,P.value=null,T.value=null)},300)},te=()=>{A.value=!0,clearTimeout(N.value)},H=()=>{A.value=!1,O()},se=l=>{P.value=l,T.value=null},le=l=>{T.value=l},G=l=>{if(!P.value)return[];const e=M.categories.find(_=>_.id===P.value);if(!e||!e.children)return[];const s=e.children.find(_=>_.id===l);return(s==null?void 0:s.children)||[]},K=()=>{clearTimeout(N.value)},ae=()=>{if(clearTimeout(v.value),!b.value.trim()){w.value=[];return}v.value=setTimeout(()=>{ne()},300)},ne=async()=>{if(!b.value.trim()){w.value=[];return}y.value=!0;try{const l=await E.get(route("client.products.search"),{params:{query:b.value}});w.value=l.data}catch(l){console.error("Search error:",l),w.value=[]}finally{y.value=!1}},oe=()=>{b.value.trim()&&me.get(route("client.products.search-page"),{query:b.value.trim()})},W=()=>{setTimeout(()=>{u.value=!1},200)},ie=()=>{u.value=!0},re=async()=>{if($.value.length>0){h.value=!0;return}try{const l=await E.get(route("client.drawing.list"));$.value=l.data,h.value=!0}catch(l){console.error("Failed to fetch drawings",l),$.value=[],h.value=!0}},ue=()=>{setTimeout(()=>{h.value=!1},300)};ge(()=>{});function X(l,e){o.items[l].withPrinting!==e&&o.togglePrinting(l)}function Y(l){return l.price+(l.withPrinting?o.printingCost:0)}return z(()=>o.items.some(l=>l.withPrinting)),z(()=>o.items.reduce((l,e)=>l+(e.withPrinting?o.printingCost*e.quantity:0),0)),(l,e)=>(a(),n("header",fe,[t("div",be,[t("div",ye,[t("div",ke,[t("div",Ce,[t("div",we,[e[15]||(e[15]=j('<div class="d-block d-md-none"><a href="tel:+74993943841" class="header__phone">8 (499) 394-38-41</a></div><span class="company">|</span><div class="header__top__block company"><a href="">О компании</a></div><span>|</span><div class="header__top__block"><button type="submit" class="btn btn-primary submit-btn btn__red">ЗАКАЗАТЬ ЗВОНОК</button></div><span>|</span>',6)),t("div",Se,[t("div",{class:"header__top__cart",onClick:e[0]||(e[0]=s=>g(o).toggleCart())},[t("div",Me,[e[13]||(e[13]=t("img",{src:"/img/cart.png",alt:""},null,-1)),g(o).totalItems>0?(a(),n("span",Pe,c(g(o).totalItems),1)):f("",!0)]),e[14]||(e[14]=t("div",{class:"header__top__info"},[t("p",{class:"min__order"},"Минимальный заказ"),t("p",{class:"rub"},"15 000 Р")],-1))])])])])])])]),t("div",$e,[t("div",Te,[e[19]||(e[19]=t("div",{class:"col-xl-2"},[t("img",{src:"https://web-ruslan.ru/img/logo.png",alt:"logo"})],-1)),t("div",qe,[e[17]||(e[17]=t("button",{class:"navbar-toggler ds-mob",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarNav","aria-controls":"navbarNav","aria-expanded":"false","aria-label":"Toggle navigation"},[t("span",{class:"navbar-toggler-icon"})],-1)),t("div",Ie,[q(t("input",{type:"text",class:"form-control",placeholder:"Поиск товаров по названию или артикулу","onUpdate:modelValue":e[1]||(e[1]=s=>b.value=s),onInput:ae,onFocus:e[2]||(e[2]=s=>u.value=!0),onBlur:W},null,544),[[J,b.value]]),t("div",Ne,[t("button",{class:"btn btn-secondary",type:"button",onClick:e[3]||(e[3]=(...s)=>l.submitSearch&&l.submitSearch(...s))},e[16]||(e[16]=[t("img",{src:"https://web-ruslan.ru/img/ser.png",alt:"search"},null,-1)]))]),q(t("div",{class:"search-results-dropdown",onMouseenter:ie,onMouseleave:W},[(a(!0),n(C,null,S(w.value,s=>(a(),n("div",{class:"search-result-item",key:s.id},[L(g(R),{href:l.route("client.products.show",s.url)},{default:x(()=>[V(c(s.title)+" ("+c(s.article)+") ",1)]),_:2},1032,["href"])]))),128)),b.value?(a(),n("div",Ae,[t("a",{href:"#",onClick:U(oe,["prevent"])},' Все результаты по запросу "'+c(b.value)+'" ',1)])):f("",!0)],544),[[Z,u.value&&w.value.length>0]]),q(t("div",Oe,[y.value?(a(),n("div",Ve," Загрузка... ")):(a(),n(C,{key:1},[w.value.length===0&&b.value?(a(),n("div",De," Ничего не найдено ")):f("",!0)],64))],512),[[Z,u.value]])])]),e[20]||(e[20]=j('<div class="col-xl-2 phone__mob__none"><span><a href="">8 (499) 394 38 41</a></span></div><div class="catalogmobile__my"><div class="nav-item catalog"><a class="nav-link" href="#">КАТАЛОГ</a><span></span></div></div>',2)),t("div",{class:"nav-item catalog mobile-only",onClick:e[4]||(e[4]=(...s)=>l.toggleMobileCatalog&&l.toggleMobileCatalog(...s))},e[18]||(e[18]=[t("a",{class:"nav-link",href:"#"},"КАТАЛОГ",-1),t("span",null,null,-1)])),l.showMobileCatalog?(a(),n("div",Be,[t("button",{class:"close-btn",onClick:e[5]||(e[5]=(...s)=>l.toggleMobileCatalog&&l.toggleMobileCatalog(...s))},"Закрыть"),t("ul",Qe,[(a(!0),n(C,null,S(i.categories,s=>{var _;return a(),n("li",{key:s.id},[t("div",{class:"category-title",onClick:d=>l.toggleMobileSubcategory(s.id)},c(s.title),9,ze),l.mobileActiveCategory===s.id&&((_=s.children)!=null&&_.length)?(a(),n("ul",Fe,[(a(!0),n(C,null,S(s.children,d=>(a(),n("li",{key:d.id},[t("a",{class:"subcategory-title",href:`/categories/${d.url}/products`,onClick:U(Q=>l.toggleMobileSubSubcategory(d.id),["stop"])},c(d.title),9,Je),l.mobileActiveSubcategory===d.id?(a(),n("ul",Ue,[(a(!0),n(C,null,S(G(d.id),Q=>(a(),n("li",{key:Q.id},[t("a",{href:`/categories/${Q.url}/products`},c(Q.title),9,xe)]))),128))])):f("",!0)]))),128))])):f("",!0)])}),128))])])):f("",!0)]),t("div",Re,[e[31]||(e[31]=t("div",{class:"col-xl-2"},null,-1)),t("div",je,[t("nav",Le,[t("div",Ee,[t("div",He,[t("ul",Ge,[t("li",{class:"nav-item catal catalog__desc",onMouseenter:F,onMouseleave:H},[e[21]||(e[21]=t("a",{class:"nav-link catalog__mar",href:"#"},"КАТАЛОГ",-1)),e[22]||(e[22]=t("span",null,null,-1)),D.value?(a(),n("section",{key:0,class:"catalog_drop",onMouseenter:te,onMouseleave:H},[t("div",Ke,[t("div",We,[(a(!0),n(C,null,S(i.categories,s=>{var _;return a(),n("a",{href:`/categories/${s.url}/products`,class:"item",key:s.id,onMouseenter:d=>se(s.id)},[t("div",Ye,[t("div",Ze,[t("p",et,c(s.title),1)])]),P.value===s.id&&((_=s.children)!=null&&_.length)?(a(),n("div",{key:0,class:"subcategories",onMouseenter:K},[t("div",tt,[(a(!0),n(C,null,S(s.children,d=>(a(),n("a",{key:d.id,href:`/categories/${d.url}/products`,onMouseenter:Q=>le(d.id)},c(d.title),41,st))),128))]),T.value?(a(),n("div",{key:0,class:"sub-subcategories",onMouseenter:K},[(a(!0),n(C,null,S(G(T.value),d=>(a(),n("div",{key:d.id},[t("a",{href:`/catalog/${d.url}/`},c(d.title),9,lt)]))),128))],32)):f("",!0)],32)):f("",!0)],40,Xe)}),128))])])],32)):f("",!0)],32),e[27]||(e[27]=t("li",{class:"nav-item"},[t("a",{class:"nav-link",href:"/portfolio"},"ПОРТФОЛИО")],-1)),t("li",{class:"nav-item drawing-menu",onMouseenter:re,onMouseleave:ue},[e[23]||(e[23]=t("a",{class:"nav-link",href:"#"},"НАНЕСЕНИЕ",-1)),e[24]||(e[24]=t("span",null,null,-1)),h.value?(a(),n("div",at,[t("div",nt,[(a(!0),n(C,null,S(B.value,s=>(a(),_e(g(R),{key:s.id,href:l.route("client.drawing.show",s.url),class:"drawing-dropdown-item"},{default:x(()=>[V(c(s.title),1)]),_:2},1032,["href"]))),128))])])):f("",!0)],32),t("li",ot,[L(g(R),{class:"nav-link",href:l.route("client.contacts.index")},{default:x(()=>e[25]||(e[25]=[V("КОНТАКТЫ")])),_:1,__:[25]},8,["href"])]),e[28]||(e[28]=t("li",{class:"nav-item"},[t("a",{class:"nav-link",href:"/news"},"НОВОСТИ")],-1)),t("li",it,[L(g(R),{class:"nav-link",href:l.route("client.payment-delivery.index")},{default:x(()=>e[26]||(e[26]=[V("ОПЛАТА И ДОСТАВКА")])),_:1,__:[26]},8,["href"])]),e[29]||(e[29]=j('<li class="nav-item nav__block__none"><a class="more_menu nav-link" href="#">Преимущества</a></li><li class="nav-item nav__block__none"><a class="more_menu nav-link" href="#">Награды</a></li><li class="nav-item nav__block__none"><a class="more_menu nav-link" href="#">Благодарности</a></li><li class="nav-item nav__block__none"><a class="more_menu nav-link" href="#">Новости</a></li><li class="nav-item nav__block__none"><a class="more_menu nav-link" href="#">Статьи</a></li><li class="nav-item nav__block__none"><a class="more_menu nav-link" href="#">Вопросы и ответы</a></li><li class="nav-item nav__block__none menu__phone"><a class="nav-link" href="#">8 (499) 394 38 41</a></li><li class="nav-item nav__block__none"><a class="nav-link menu__email" href="#">info@mvgifts.ru</a></li>',8))]),e[30]||(e[30]=t("button",{class:"btn-close d-lg-none ms-auto",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarNav","aria-controls":"navbarNav","aria-label":"Close"},null,-1))])])])]),e[32]||(e[32]=t("div",{class:"col-xl-2"},null,-1))])]),g(o).isOpen?(a(),n("div",{key:0,class:"cart-popup-overlay",onClick:e[12]||(e[12]=U(s=>g(o).closeCart(),["self"]))},[t("div",rt,[t("div",ut,[e[33]||(e[33]=t("h3",null,"Корзина",-1)),t("button",{class:"close-cart",onClick:e[6]||(e[6]=s=>g(o).closeCart())},"×")]),t("div",ct,[k.value?(a(),n("div",dt,c(k.value),1)):f("",!0),p.value?(a(),n("div",vt,[V(c(p.value)+" ",1),t("button",{class:"error-close",onClick:e[7]||(e[7]=s=>p.value="")},"×")])):f("",!0),g(o).items.length===0?(a(),n("div",gt," Корзина пуста ")):(a(),n("div",pt,[(a(!0),n(C,null,S(g(o).items,(s,_)=>(a(),n("div",{key:_,class:"cart-item"},[t("div",_t,[t("img",{src:s.image,alt:s.title},null,8,mt)]),t("div",ht,[t("h4",null,c(s.title),1),t("p",null,"Цвет: "+c(s.color)+", Размер: "+c(s.size),1),t("p",null,"Артикул: "+c(s.article),1),t("div",ft,[t("div",bt,[t("button",{class:ee({"printing-btn":!0,active:!s.withPrinting}),onClick:d=>X(_,!1)}," Без нанесения ",10,yt),t("button",{class:ee({"printing-btn":!0,active:s.withPrinting}),onClick:d=>X(_,!0)}," С нанесением (+ "+c(g(o).printingCost)+" ₽) ",11,kt)])]),t("div",Ct,c(Y(s))+" ₽ × "+c(s.quantity)+" = "+c(Y(s)*s.quantity)+" ₽ ",1)]),t("div",wt,[t("div",St,[t("button",{onClick:d=>g(o).updateQuantity(_,s.quantity-1)},"-",8,Mt),t("span",null,c(s.quantity),1),t("button",{onClick:d=>g(o).updateQuantity(_,s.quantity+1)},"+",8,Pt)]),t("button",{class:"remove-item",onClick:d=>g(o).removeItem(_)},"Удалить",8,$t)])]))),128))]))]),g(o).items.length>0?(a(),n("div",Tt,[t("form",{onSubmit:U(I,["prevent"]),class:"order-form"},[t("div",qt,[e[34]||(e[34]=t("label",{for:"name"},null,-1)),q(t("input",{type:"text",id:"name","onUpdate:modelValue":e[8]||(e[8]=s=>r.name=s),placeholder:"Ваше имя"},null,512),[[J,r.name]])]),t("div",It,[e[35]||(e[35]=t("label",{for:"phone"},null,-1)),q(t("input",{type:"tel",id:"phone","onUpdate:modelValue":e[9]||(e[9]=s=>r.phone=s),placeholder:"+7 (999) 999-99-99"},null,512),[[J,r.phone]])]),t("div",Nt,[e[36]||(e[36]=t("label",{for:"email"},null,-1)),q(t("input",{type:"email",id:"email","onUpdate:modelValue":e[10]||(e[10]=s=>r.email=s),placeholder:"your@email.com"},null,512),[[J,r.email]])]),t("div",At,[q(t("input",{type:"checkbox",id:"privacy","onUpdate:modelValue":e[11]||(e[11]=s=>r.agreedToPrivacy=s)},null,512),[[pe,r.agreedToPrivacy]]),e[37]||(e[37]=t("label",{for:"privacy"},[V(" Я согласен с "),t("a",{style:{"text-decoration":"underline"},href:"/privacy-policy",target:"_blank"},"политикой конфиденциальности")],-1))]),t("div",Ot," Общая сумма: "+c(g(o).totalPrice)+" Р ",1),e[38]||(e[38]=t("button",{type:"submit",class:"btn btn-primary submit-btn btn__red"}," Оформить заказ ",-1))],32)])):f("",!0)])])):f("",!0)]))}});export{Bt as _,he as u};
