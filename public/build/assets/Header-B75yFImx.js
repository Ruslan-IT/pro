import{C as pe,s as p,p as B,i as L,D as _e,E as me,y as he,c as n,o as a,a as e,j as y,A as te,u as g,t as v,e as q,v as J,G as fe,B as se,F as C,g as w,h as U,n as z,b as E,w as R,d as V,S as j,q as be,Q as ye,l as ke}from"./app-BeOObbwT.js";const Ce=pe("cart",()=>{const o=p([]),b=p(!1),S=0;localStorage.getItem("cart")&&(o.value=JSON.parse(localStorage.getItem("cart")));const I=B(()=>o.value.reduce((u,r)=>u+r.quantity,0)),i=B(()=>o.value.reduce((u,r)=>{const m=r.price+(r.withPrinting?S:0);return u+m*r.quantity},0));function c(u,r,m,f,F,T=!1){const M=o.value.findIndex(k=>k.id===u.id&&k.color===r&&k.size===m&&k.withPrinting===T);M!==-1?o.value[M].quantity+=f:o.value.push({id:`${u.id}_${r}_${m}_${T?"with_printing":"without_printing"}`,product_id:u.id,title:u.title,price:u.price,image:F,color:r,size:m,quantity:f,article:u.article,withPrinting:T}),localStorage.setItem("cart",JSON.stringify(o.value))}function _(u){o.value.splice(u,1),localStorage.setItem("cart",JSON.stringify(o.value))}function A(u,r){if(r<=0){_(u);return}o.value[u].quantity=r,localStorage.setItem("cart",JSON.stringify(o.value))}function Q(){o.value=[],localStorage.removeItem("cart")}function x(){b.value=!0}function N(){b.value=!1}function P(){b.value=!b.value}function $(u){o.value[u]&&(o.value[u].withPrinting=!o.value[u].withPrinting,localStorage.setItem("cart",JSON.stringify(o.value)))}async function O(u){var r,m;try{const f=await L.post(route("client.cart.store"),u);if(f.data.success)return Q(),{success:!0,message:f.data.message}}catch(f){return console.error("Ошибка при отправке заказа:",f),{success:!1,message:((m=(r=f.response)==null?void 0:r.data)==null?void 0:m.message)||"Произошла ошибка при отправке заказа"}}}return{items:o,isOpen:b,totalItems:I,totalPrice:i,addItem:c,removeItem:_,updateQuantity:A,clearCart:Q,openCart:x,closeCart:N,toggleCart:P,submitOrder:O,togglePrinting:$,printingCost:S}}),we={class:"header"},Se={class:"row header__top__block__main"},Me={class:"container__header"},Pe={class:"container__header__flex"},$e={class:""},Te={class:"header__top d-flex"},qe={class:"header__top__block"},Ie={class:"header__top__img"},Ae={key:0,id:"cart_qty"},Ne={class:"container"},Oe={class:"row header__search"},Ve={class:"col-xl-8"},xe={class:"input-group"},De={key:0,class:"search-result-item view-all"},Be={class:"search-results-dropdown"},Qe={key:0,class:"search-loading"},Fe={key:0,class:"no-results"},Je={key:0,class:"mobile-catalog-menu"},Ue={class:"mobile-catalog-list"},ze=["onClick"],Re={key:0},je=["href","onClick"],Ee={key:0},Le=["href"],He={class:"row header__menu"},Ke={class:"col-xl-8"},Ge={class:"navbar navbar-expand-lg navbar-light bg-light"},We={class:"container-fluid header__menu"},Xe={class:"navbar-nav"},Ye={class:"wrap_c"},Ze={class:"list"},et=["href","onMouseenter"],tt={class:"table"},st={class:"margin"},lt={style:{"text-transform":"uppercase"}},at={class:"subcategory-column"},nt=["href","onMouseenter"],ot=["href"],it={key:0,class:"drawing-dropdown"},rt={class:"drawing-dropdown-content"},ut={class:"nav-item"},ct={class:"nav-item"},dt={class:"cart-popup"},vt={class:"cart-popup-header"},gt={class:"cart-popup-content"},pt={key:0,class:"success-message"},_t={key:1,class:"error-message"},mt={key:2,class:"empty-cart"},ht={key:3},ft={class:"cart-item-image"},bt=["src","alt"],yt={class:"cart-item-details"},kt={class:"printing-option"},Ct={class:"printing-buttons"},wt=["onClick"],St=["onClick"],Mt={class:"cart-item-price"},Pt={class:"cart-item-controls"},$t={class:"quantity-controls"},Tt=["onClick"],qt=["onClick"],It=["onClick"],At={key:0,class:"cart-popup-footer"},Nt={class:"form-group"},Ot={class:"form-group"},Vt={class:"form-group"},xt={class:"form-group checkbox"},Dt={class:"cart-total"},Bt={data(){return{showMobileCatalog:!1,mobileActiveCategory:null,mobileActiveSubcategory:null}},methods:{toggleMobileCatalog(){this.showMobileCatalog=!this.showMobileCatalog,this.mobileActiveCategory=null,this.mobileActiveSubcategory=null},toggleMobileSubcategory(o){this.mobileActiveCategory=this.mobileActiveCategory===o?null:o,this.mobileActiveSubcategory=null},toggleMobileSubSubcategory(o){this.mobileActiveSubcategory=this.mobileActiveSubcategory===o?null:o},getSubSubcategories(o){var I;const b=this.categories.find(i=>{var c;return(c=i.children)==null?void 0:c.some(_=>_.id===o)}),S=(I=b==null?void 0:b.children)==null?void 0:I.find(i=>i.id===o);return(S==null?void 0:S.children)||[]}}},Ft=Object.assign(Bt,{__name:"Header",props:{categories:Array,drawings:Array},setup(o){const b=p(!1);function S(){b.value=!b.value}function I(){b.value=!1}const i=Ce(),c=_e({name:"",phone:"",email:"",agreedToPrivacy:!1}),_=p(""),A=p("");async function Q(){if(_.value="",!c.name){_.value="Введите имя";return}if(!c.phone){_.value="Введите телефон";return}if(!c.email){_.value="Введите email";return}if(!c.agreedToPrivacy){console.log("Нет согласия с политикой"),_.value="Необходимо согласие с политикой конфиденциальности";return}if(!c.name||!c.phone||!c.email){_.value="Заполните все обязательные поля";return}const l={name:c.name,phone:c.phone,email:c.email,agreed_to_privacy:c.agreedToPrivacy,items:i.items.map(t=>({id:t.id,title:t.title,price:t.price,with_printing:t.withPrinting,printing_cost:t.withPrinting?i.printingCost:0,color:t.color,size:t.size,quantity:t.quantity,article:t.article,image:t.image})),total_price:i.totalPrice};try{const t=await i.submitOrder(l);t.success?(A.value=t.message,setTimeout(()=>{Object.assign(c,{name:"",phone:"",email:"",agreedToPrivacy:!1}),i.closeCart(),A.value=""},2e3)):_.value=t.message}catch(t){_.value="Произошла ошибка при отправке заказа",console.error("Ошибка при отправке заказа:",t)}}const x=o,N=p(!1),P=p(null),$=p(null),O=p(null),u=p(!1),r=p(""),m=p([]),f=p(!1),F=p(null),T=p(!1),M=p(!1),k=p([]),le=B(()=>k.value.length>0?k.value:x.drawings||[]);me(()=>x.drawings,l=>{l&&l.length>0&&(k.value=l)},{immediate:!0});const ae=()=>{clearTimeout(O.value),N.value=!0,u.value=!0},ne=()=>{O.value=setTimeout(()=>{u.value||(N.value=!1,P.value=null,$.value=null)},300)},oe=()=>{u.value=!0,clearTimeout(O.value)},H=()=>{u.value=!1,ne()},ie=l=>{P.value=l,$.value=null},re=l=>{$.value=l},K=l=>{if(!P.value)return[];const t=x.categories.find(h=>h.id===P.value);if(!t||!t.children)return[];const s=t.children.find(h=>h.id===l);return(s==null?void 0:s.children)||[]},G=()=>{clearTimeout(O.value)},ue=()=>{if(clearTimeout(F.value),!r.value.trim()){m.value=[];return}F.value=setTimeout(()=>{ce()},300)},W=()=>{r.value.trim()?X():f.value=!1},ce=async()=>{if(!r.value.trim()){m.value=[];return}T.value=!0;try{const l=await L.get(route("client.products.search"),{params:{query:r.value}});m.value=l.data}catch(l){console.error("Search error:",l),m.value=[]}finally{T.value=!1}},X=()=>{r.value.trim()&&ye.get(route("client.products.search-page"),{query:r.value.trim()})},Y=()=>{setTimeout(()=>{f.value=!1},200)},de=()=>{f.value=!0},ve=async()=>{if(k.value.length>0){M.value=!0;return}try{const l=await L.get(route("client.drawing.list"));k.value=l.data,M.value=!0}catch(l){console.error("Failed to fetch drawings",l),k.value=[],M.value=!0}},ge=()=>{setTimeout(()=>{M.value=!1},300)};he(()=>{});function Z(l,t){i.items[l].withPrinting!==t&&i.togglePrinting(l)}function ee(l){return l.price+(l.withPrinting?i.printingCost:0)}return B(()=>i.items.some(l=>l.withPrinting)),B(()=>i.items.reduce((l,t)=>l+(t.withPrinting?i.printingCost*t.quantity:0),0)),(l,t)=>(a(),n("header",we,[e("div",Se,[e("div",Me,[e("div",Pe,[e("div",$e,[e("div",Te,[t[14]||(t[14]=te('<div class="d-block d-md-none"><a href="tel:+74993943841" class="header__phone">8 (499) 394-38-41</a></div><span class="company">|</span><div class="header__top__block company"><a href="">О компании</a></div><span>|</span><div class="header__top__block"><button type="submit" class="btn btn-primary submit-btn btn__red">ЗАКАЗАТЬ ЗВОНОК</button></div><span>|</span>',6)),e("div",qe,[e("div",{class:"header__top__cart",onClick:t[0]||(t[0]=s=>g(i).toggleCart())},[e("div",Ie,[t[12]||(t[12]=e("img",{src:"/img/cart.png",alt:""},null,-1)),g(i).totalItems>0?(a(),n("span",Ae,v(g(i).totalItems),1)):y("",!0)]),t[13]||(t[13]=e("div",{class:"header__top__info"},[e("p",{class:"min__order"},"Минимальный заказ"),e("p",{class:"rub"},"15 000 Р")],-1))])])])])])])]),e("div",Ne,[e("div",Oe,[t[18]||(t[18]=e("div",{class:"col-xl-2"},[e("img",{src:"https://web-ruslan.ru/img/logo.png",alt:"logo"})],-1)),e("div",Ve,[e("button",{class:"navbar-toggler ds-mob",type:"button",onClick:S,"aria-controls":"navbarNav","aria-expanded":"isMenuOpen","aria-label":"Toggle navigation"},t[15]||(t[15]=[e("span",{class:"navbar-toggler-icon"},null,-1)])),e("div",xe,[q(e("input",{type:"text",class:"form-control",placeholder:"Поиск товаров по названию или артикулу","onUpdate:modelValue":t[1]||(t[1]=s=>r.value=s),onInput:ue,onFocus:t[2]||(t[2]=s=>f.value=!0),onBlur:Y,onKeyup:fe(W,["enter"])},null,544),[[J,r.value]]),e("div",{class:"input-group-append"},[e("button",{class:"btn btn-secondary",type:"button",onClick:W},t[16]||(t[16]=[e("img",{src:"https://web-ruslan.ru/img/ser.png",alt:"search"},null,-1)]))]),q(e("div",{class:"search-results-dropdown",onMouseenter:de,onMouseleave:Y},[(a(!0),n(C,null,w(m.value,s=>(a(),n("div",{class:"search-result-item",key:s.id},[E(g(j),{href:l.route("client.products.show",s.url)},{default:R(()=>[V(v(s.title)+" ("+v(s.article)+") ",1)]),_:2},1032,["href"])]))),128)),r.value?(a(),n("div",De,[e("a",{href:"#",onClick:U(X,["prevent"])},' Все результаты по запросу "'+v(r.value)+'" ',1)])):y("",!0)],544),[[se,f.value&&m.value.length>0]]),q(e("div",Be,[T.value?(a(),n("div",Qe," Загрузка... ")):(a(),n(C,{key:1},[m.value.length===0&&r.value?(a(),n("div",Fe," Ничего не найдено ")):y("",!0)],64))],512),[[se,f.value]])])]),t[19]||(t[19]=e("div",{class:"col-xl-2 phone__mob__none"},[e("span",null,[e("a",{href:""},"8 (499) 394 38 41")])],-1)),e("div",{class:"nav-item catalog mobile-only",onClick:t[3]||(t[3]=(...s)=>l.toggleMobileCatalog&&l.toggleMobileCatalog(...s))},t[17]||(t[17]=[e("div",{class:"burger-icon"},[e("span"),e("span"),e("span")],-1),e("a",{class:"nav-link mob__catalog",href:"#"},"КАТАЛОГ",-1),e("span",null,null,-1)])),l.showMobileCatalog?(a(),n("div",Je,[e("button",{class:"btn-close d-lg-none ms-auto",type:"button","aria-controls":"navbarNav","aria-label":"Close",onClick:t[4]||(t[4]=(...s)=>l.toggleMobileCatalog&&l.toggleMobileCatalog(...s))}),e("ul",Ue,[(a(!0),n(C,null,w(o.categories,s=>{var h;return a(),n("li",{class:"mobile__catalog__li",key:s.id},[e("div",{style:{"text-transform":"uppercase"},class:"category-title",onClick:d=>l.toggleMobileSubcategory(s.id)},v(s.title),9,ze),l.mobileActiveCategory===s.id&&((h=s.children)!=null&&h.length)?(a(),n("ul",Re,[(a(!0),n(C,null,w(s.children,d=>(a(),n("li",{key:d.id},[e("a",{class:"subcategory-title",href:`/categories/${d.url}/products`,onClick:U(D=>l.toggleMobileSubSubcategory(d.id),["stop"]),style:{"text-transform":"uppercase"}},v(d.title),9,je),l.mobileActiveSubcategory===d.id?(a(),n("ul",Ee,[(a(!0),n(C,null,w(K(d.id),D=>(a(),n("li",{key:D.id},[e("a",{href:`/categories/${D.url}/products`},v(D.title),9,Le)]))),128))])):y("",!0)]))),128))])):y("",!0)])}),128))])])):y("",!0)]),e("div",He,[t[29]||(t[29]=e("div",{class:"col-xl-2"},null,-1)),e("div",Ke,[e("nav",Ge,[e("div",We,[e("div",{class:z(["collapse navbar-collapse",{show:b.value}]),id:"navbarNav"},[e("ul",Xe,[e("li",{class:z(["nav-item catal catalog__desc",{active:N.value}]),onMouseenter:ae,onMouseleave:H},[t[20]||(t[20]=e("a",{class:"nav-link catalog__mar",href:"#"},"КАТАЛОГ",-1)),t[21]||(t[21]=e("span",null,null,-1)),N.value?(a(),n("section",{key:0,class:"catalog_drop",onMouseenter:oe,onMouseleave:H},[e("div",Ye,[e("div",Ze,[(a(!0),n(C,null,w(o.categories,s=>{var h;return a(),n("a",{href:`/categories/${s.url}/products`,class:"item",key:s.id,onMouseenter:d=>ie(s.id)},[e("div",tt,[e("div",st,[e("p",lt,v(s.title),1)])]),P.value===s.id&&((h=s.children)!=null&&h.length)?(a(),n("div",{key:0,class:"subcategories",onMouseenter:G},[e("div",at,[(a(!0),n(C,null,w(s.children,d=>(a(),n("a",{key:d.id,href:`/categories/${d.url}/products`,onMouseenter:D=>re(d.id)},v(d.title),41,nt))),128))]),$.value?(a(),n("div",{key:0,class:"sub-subcategories",onMouseenter:G},[(a(!0),n(C,null,w(K($.value),d=>(a(),n("div",{key:d.id},[e("a",{href:`/catalog/${d.url}/`},v(d.title),9,ot)]))),128))],32)):y("",!0)],32)):y("",!0)],40,et)}),128))])])],32)):y("",!0)],34),t[26]||(t[26]=e("li",{class:"nav-item"},[e("a",{class:"nav-link",href:"/portfolio"},"ПОРТФОЛИО")],-1)),e("li",{class:"nav-item drawing-menu",onMouseenter:ve,onMouseleave:ge},[t[22]||(t[22]=e("a",{class:"nav-link",href:"#"},"НАНЕСЕНИЕ",-1)),t[23]||(t[23]=e("span",null,null,-1)),M.value?(a(),n("div",it,[e("div",rt,[(a(!0),n(C,null,w(le.value,s=>(a(),ke(g(j),{key:s.id,href:l.route("client.drawing.show",s.url),class:"drawing-dropdown-item",style:{"text-transform":"uppercase"}},{default:R(()=>[V(v(s.title),1)]),_:2},1032,["href"]))),128))])])):y("",!0)],32),e("li",ut,[E(g(j),{class:"nav-link",href:l.route("client.contacts.index")},{default:R(()=>t[24]||(t[24]=[V("КОНТАКТЫ")])),_:1,__:[24]},8,["href"])]),t[27]||(t[27]=e("li",{class:"nav-item"},[e("a",{class:"nav-link",href:"/news"},"НОВОСТИ")],-1)),e("li",ct,[E(g(j),{class:"nav-link",href:l.route("client.payment-delivery.index")},{default:R(()=>t[25]||(t[25]=[V("ОПЛАТА И ДОСТАВКА")])),_:1,__:[25]},8,["href"])]),t[28]||(t[28]=te('<li class="nav-item nav__block__none"><a class="more_menu nav-link" href="/preimushestva">Преимущества</a></li><li class="nav-item nav__block__none"><a class="more_menu nav-link" href="/nagrady">Награды</a></li><li class="nav-item nav__block__none"><a class="more_menu nav-link" href="/blagodarnost">Благодарности</a></li><li class="nav-item nav__block__none"><a class="more_menu nav-link" href="/news">Новости</a></li><li class="nav-item nav__block__none"><a class="more_menu nav-link" href="/articles">Статьи</a></li><li class="nav-item nav__block__none"><a class="more_menu nav-link" href="/voprosy-i-otvety">Вопросы и ответы</a></li><li class="nav-item nav__block__none menu__phone"><a class="nav-link" href="tel:+74993943841" title="Позвонить нам">8 (499) 394 38 41</a></li><li class="nav-item nav__block__none"><a class="nav-link menu__email" href="mailto:info@mvgifts.ru" title="Написать нам">info@mvgifts.ru</a></li>',8))]),e("button",{class:"btn-close d-lg-none ms-auto",type:"button",onClick:I,"aria-controls":"navbarNav","aria-label":"Close"})],2)])])]),t[30]||(t[30]=e("div",{class:"col-xl-2"},null,-1))])]),g(i).isOpen?(a(),n("div",{key:0,class:"cart-popup-overlay",onClick:t[11]||(t[11]=U(s=>g(i).closeCart(),["self"]))},[e("div",dt,[e("div",vt,[t[31]||(t[31]=e("h3",null,"Корзина",-1)),e("button",{class:"close-cart",onClick:t[5]||(t[5]=s=>g(i).closeCart())},"×")]),e("div",gt,[A.value?(a(),n("div",pt,v(A.value),1)):y("",!0),_.value?(a(),n("div",_t,[V(v(_.value)+" ",1),e("button",{class:"error-close",onClick:t[6]||(t[6]=s=>_.value="")},"×")])):y("",!0),g(i).items.length===0?(a(),n("div",mt," Корзина пуста ")):(a(),n("div",ht,[(a(!0),n(C,null,w(g(i).items,(s,h)=>(a(),n("div",{key:h,class:"cart-item"},[e("div",ft,[e("img",{src:s.image,alt:s.title},null,8,bt)]),e("div",yt,[e("h4",null,v(s.title),1),e("p",null,"Цвет: "+v(s.color)+", Размер: "+v(s.size),1),e("p",null,"Артикул: "+v(s.article),1),e("div",kt,[e("div",Ct,[e("button",{class:z({"printing-btn":!0,active:!s.withPrinting}),onClick:d=>Z(h,!1)}," Без нанесения ",10,wt),e("button",{class:z({"printing-btn":!0,active:s.withPrinting}),onClick:d=>Z(h,!0)}," С нанесением ",10,St)])]),e("div",Mt,v(ee(s))+" ₽ × "+v(s.quantity)+" = "+v(ee(s)*s.quantity)+" ₽ ",1)]),e("div",Pt,[e("div",$t,[e("button",{onClick:d=>g(i).updateQuantity(h,s.quantity-1)},"-",8,Tt),e("span",null,v(s.quantity),1),e("button",{onClick:d=>g(i).updateQuantity(h,s.quantity+1)},"+",8,qt)]),e("button",{class:"remove-item",onClick:d=>g(i).removeItem(h)},"Удалить",8,It)])]))),128))]))]),g(i).items.length>0?(a(),n("div",At,[e("form",{onSubmit:U(Q,["prevent"]),class:"order-form"},[e("div",Nt,[t[32]||(t[32]=e("label",{for:"name"},null,-1)),q(e("input",{type:"text",id:"name","onUpdate:modelValue":t[7]||(t[7]=s=>c.name=s),placeholder:"Ваше имя"},null,512),[[J,c.name]])]),e("div",Ot,[t[33]||(t[33]=e("label",{for:"phone"},null,-1)),q(e("input",{type:"tel",id:"phone","onUpdate:modelValue":t[8]||(t[8]=s=>c.phone=s),placeholder:"+7 (999) 999-99-99"},null,512),[[J,c.phone]])]),e("div",Vt,[t[34]||(t[34]=e("label",{for:"email"},null,-1)),q(e("input",{type:"email",id:"email","onUpdate:modelValue":t[9]||(t[9]=s=>c.email=s),placeholder:"your@email.com"},null,512),[[J,c.email]])]),e("div",xt,[q(e("input",{type:"checkbox",id:"privacy","onUpdate:modelValue":t[10]||(t[10]=s=>c.agreedToPrivacy=s)},null,512),[[be,c.agreedToPrivacy]]),t[35]||(t[35]=e("label",{for:"privacy"},[V(" Я согласен с "),e("a",{style:{"text-decoration":"underline"},href:"/pages/privacy-policy",target:"_blank"}," политикой конфиденциальности")],-1))]),e("div",Dt," Общая сумма: "+v(g(i).totalPrice)+" Р ",1),t[36]||(t[36]=e("button",{type:"submit",class:"btn btn-primary submit-btn btn__red"}," Оформить заказ ",-1))],32)])):y("",!0)])])):y("",!0)]))}});export{Ft as _,Ce as u};
