import{A as ge,s as p,p as Q,i as E,B as pe,C as _e,y as me,c as a,o as n,a as e,j as y,D as Z,u as g,t as d,e as q,v as J,z as ee,F as C,g as w,h as U,n as j,b as L,w as x,d as N,S as R,q as he,l as fe,Q as be}from"./app-Cyyyi0Um.js";const ye=ge("cart",()=>{const i=p([]),f=p(!1),S=100;localStorage.getItem("cart")&&(i.value=JSON.parse(localStorage.getItem("cart")));const I=Q(()=>i.value.reduce((r,u)=>r+u.quantity,0)),o=Q(()=>i.value.reduce((r,u)=>{const m=u.price+(u.withPrinting?S:0);return r+m*u.quantity},0));function c(r,u,m,b,F,T=!1){const M=i.value.findIndex(k=>k.id===r.id&&k.color===u&&k.size===m&&k.withPrinting===T);M!==-1?i.value[M].quantity+=b:i.value.push({id:`${r.id}_${u}_${m}_${T?"with_printing":"without_printing"}`,product_id:r.id,title:r.title,price:r.price,image:F,color:u,size:m,quantity:b,article:r.article,withPrinting:T}),localStorage.setItem("cart",JSON.stringify(i.value))}function _(r){i.value.splice(r,1),localStorage.setItem("cart",JSON.stringify(i.value))}function A(r,u){if(u<=0){_(r);return}i.value[r].quantity=u,localStorage.setItem("cart",JSON.stringify(i.value))}function z(){i.value=[],localStorage.removeItem("cart")}function V(){f.value=!0}function D(){f.value=!1}function P(){f.value=!f.value}function $(r){i.value[r]&&(i.value[r].withPrinting=!i.value[r].withPrinting,localStorage.setItem("cart",JSON.stringify(i.value)))}async function O(r){var u,m;try{const b=await E.post(route("client.cart.store"),r);if(b.data.success)return z(),{success:!0,message:b.data.message}}catch(b){return console.error("Ошибка при отправке заказа:",b),{success:!1,message:((m=(u=b.response)==null?void 0:u.data)==null?void 0:m.message)||"Произошла ошибка при отправке заказа"}}}return{items:i,isOpen:f,totalItems:I,totalPrice:o,addItem:c,removeItem:_,updateQuantity:A,clearCart:z,openCart:V,closeCart:D,toggleCart:P,submitOrder:O,togglePrinting:$,printingCost:S}}),ke={class:"header"},Ce={class:"row header__top__block__main"},we={class:"container__header"},Se={class:"container__header__flex"},Me={class:""},Pe={class:"header__top d-flex"},$e={class:"header__top__block"},Te={class:"header__top__img"},qe={key:0,id:"cart_qty"},Ie={class:"container"},Ae={class:"row header__search"},Oe={class:"col-xl-8"},Ne={class:"input-group"},Ve={class:"input-group-append"},De={key:0,class:"search-result-item view-all"},Be={class:"search-results-dropdown"},Qe={key:0,class:"search-loading"},ze={key:0,class:"no-results"},Fe={key:0,class:"mobile-catalog-menu"},Je={class:"mobile-catalog-list"},Ue=["onClick"],xe={key:0},Re=["href","onClick"],je={key:0},Le=["href"],Ee={class:"row header__menu"},He={class:"col-xl-8"},Ge={class:"navbar navbar-expand-lg navbar-light bg-light"},Ke={class:"container-fluid header__menu"},We={class:"navbar-nav"},Xe={class:"wrap_c"},Ye={class:"list"},Ze=["href","onMouseenter"],et={class:"table"},tt={class:"margin"},st={style:{"text-transform":"uppercase"}},lt={class:"subcategory-column"},nt=["href","onMouseenter"],at=["href"],ot={key:0,class:"drawing-dropdown"},it={class:"drawing-dropdown-content"},rt={class:"nav-item"},ut={class:"nav-item"},ct={class:"cart-popup"},dt={class:"cart-popup-header"},vt={class:"cart-popup-content"},gt={key:0,class:"success-message"},pt={key:1,class:"error-message"},_t={key:2,class:"empty-cart"},mt={key:3},ht={class:"cart-item-image"},ft=["src","alt"],bt={class:"cart-item-details"},yt={class:"printing-option"},kt={class:"printing-buttons"},Ct=["onClick"],wt=["onClick"],St={class:"cart-item-price"},Mt={class:"cart-item-controls"},Pt={class:"quantity-controls"},$t=["onClick"],Tt=["onClick"],qt=["onClick"],It={key:0,class:"cart-popup-footer"},At={class:"form-group"},Ot={class:"form-group"},Nt={class:"form-group"},Vt={class:"form-group checkbox"},Dt={class:"cart-total"},Bt={data(){return{showMobileCatalog:!1,mobileActiveCategory:null,mobileActiveSubcategory:null}},methods:{toggleMobileCatalog(){this.showMobileCatalog=!this.showMobileCatalog,this.mobileActiveCategory=null,this.mobileActiveSubcategory=null},toggleMobileSubcategory(i){this.mobileActiveCategory=this.mobileActiveCategory===i?null:i,this.mobileActiveSubcategory=null},toggleMobileSubSubcategory(i){this.mobileActiveSubcategory=this.mobileActiveSubcategory===i?null:i},getSubSubcategories(i){var I;const f=this.categories.find(o=>{var c;return(c=o.children)==null?void 0:c.some(_=>_.id===i)}),S=(I=f==null?void 0:f.children)==null?void 0:I.find(o=>o.id===i);return(S==null?void 0:S.children)||[]}}},zt=Object.assign(Bt,{__name:"Header",props:{categories:Array,drawings:Array},setup(i){const f=p(!1);function S(){f.value=!f.value}function I(){f.value=!1}const o=ye(),c=pe({name:"",phone:"",email:"",agreedToPrivacy:!1}),_=p(""),A=p("");async function z(){if(_.value="",!c.name){_.value="Введите имя";return}if(!c.phone){_.value="Введите телефон";return}if(!c.email){_.value="Введите email";return}if(!c.agreedToPrivacy){console.log("Нет согласия с политикой"),_.value="Необходимо согласие с политикой конфиденциальности";return}if(!c.name||!c.phone||!c.email){_.value="Заполните все обязательные поля";return}const l={name:c.name,phone:c.phone,email:c.email,agreed_to_privacy:c.agreedToPrivacy,items:o.items.map(t=>({id:t.id,title:t.title,price:t.price,with_printing:t.withPrinting,printing_cost:t.withPrinting?o.printingCost:0,color:t.color,size:t.size,quantity:t.quantity,article:t.article,image:t.image})),total_price:o.totalPrice};try{const t=await o.submitOrder(l);t.success?(A.value=t.message,setTimeout(()=>{Object.assign(c,{name:"",phone:"",email:"",agreedToPrivacy:!1}),o.closeCart(),A.value=""},2e3)):_.value=t.message}catch(t){_.value="Произошла ошибка при отправке заказа",console.error("Ошибка при отправке заказа:",t)}}const V=i,D=p(!1),P=p(null),$=p(null),O=p(null),r=p(!1),u=p(""),m=p([]),b=p(!1),F=p(null),T=p(!1),M=p(!1),k=p([]),te=Q(()=>k.value.length>0?k.value:V.drawings||[]);_e(()=>V.drawings,l=>{l&&l.length>0&&(k.value=l)},{immediate:!0});const se=()=>{clearTimeout(O.value),D.value=!0,r.value=!0},le=()=>{O.value=setTimeout(()=>{r.value||(D.value=!1,P.value=null,$.value=null)},300)},ne=()=>{r.value=!0,clearTimeout(O.value)},H=()=>{r.value=!1,le()},ae=l=>{P.value=l,$.value=null},oe=l=>{$.value=l},G=l=>{if(!P.value)return[];const t=V.categories.find(h=>h.id===P.value);if(!t||!t.children)return[];const s=t.children.find(h=>h.id===l);return(s==null?void 0:s.children)||[]},K=()=>{clearTimeout(O.value)},ie=()=>{if(clearTimeout(F.value),!u.value.trim()){m.value=[];return}F.value=setTimeout(()=>{re()},300)},re=async()=>{if(!u.value.trim()){m.value=[];return}T.value=!0;try{const l=await E.get(route("client.products.search"),{params:{query:u.value}});m.value=l.data}catch(l){console.error("Search error:",l),m.value=[]}finally{T.value=!1}},ue=()=>{u.value.trim()&&be.get(route("client.products.search-page"),{query:u.value.trim()})},W=()=>{setTimeout(()=>{b.value=!1},200)},ce=()=>{b.value=!0},de=async()=>{if(k.value.length>0){M.value=!0;return}try{const l=await E.get(route("client.drawing.list"));k.value=l.data,M.value=!0}catch(l){console.error("Failed to fetch drawings",l),k.value=[],M.value=!0}},ve=()=>{setTimeout(()=>{M.value=!1},300)};me(()=>{});function X(l,t){o.items[l].withPrinting!==t&&o.togglePrinting(l)}function Y(l){return l.price+(l.withPrinting?o.printingCost:0)}return Q(()=>o.items.some(l=>l.withPrinting)),Q(()=>o.items.reduce((l,t)=>l+(t.withPrinting?o.printingCost*t.quantity:0),0)),(l,t)=>(n(),a("header",ke,[e("div",Ce,[e("div",we,[e("div",Se,[e("div",Me,[e("div",Pe,[t[15]||(t[15]=Z('<div class="d-block d-md-none"><a href="tel:+74993943841" class="header__phone">8 (499) 394-38-41</a></div><span class="company">|</span><div class="header__top__block company"><a href="">О компании</a></div><span>|</span><div class="header__top__block"><button type="submit" class="btn btn-primary submit-btn btn__red">ЗАКАЗАТЬ ЗВОНОК</button></div><span>|</span>',6)),e("div",$e,[e("div",{class:"header__top__cart",onClick:t[0]||(t[0]=s=>g(o).toggleCart())},[e("div",Te,[t[13]||(t[13]=e("img",{src:"/img/cart.png",alt:""},null,-1)),g(o).totalItems>0?(n(),a("span",qe,d(g(o).totalItems),1)):y("",!0)]),t[14]||(t[14]=e("div",{class:"header__top__info"},[e("p",{class:"min__order"},"Минимальный заказ"),e("p",{class:"rub"},"15 000 Р")],-1))])])])])])])]),e("div",Ie,[e("div",Ae,[t[19]||(t[19]=e("div",{class:"col-xl-2"},[e("img",{src:"https://web-ruslan.ru/img/logo.png",alt:"logo"})],-1)),e("div",Oe,[e("button",{class:"navbar-toggler ds-mob",type:"button",onClick:S,"aria-controls":"navbarNav","aria-expanded":"isMenuOpen","aria-label":"Toggle navigation"},t[16]||(t[16]=[e("span",{class:"navbar-toggler-icon"},null,-1)])),e("div",Ne,[q(e("input",{type:"text",class:"form-control",placeholder:"Поиск товаров по названию или артикулу","onUpdate:modelValue":t[1]||(t[1]=s=>u.value=s),onInput:ie,onFocus:t[2]||(t[2]=s=>b.value=!0),onBlur:W},null,544),[[J,u.value]]),e("div",Ve,[e("button",{class:"btn btn-secondary",type:"button",onClick:t[3]||(t[3]=(...s)=>l.submitSearch&&l.submitSearch(...s))},t[17]||(t[17]=[e("img",{src:"https://web-ruslan.ru/img/ser.png",alt:"search"},null,-1)]))]),q(e("div",{class:"search-results-dropdown",onMouseenter:ce,onMouseleave:W},[(n(!0),a(C,null,w(m.value,s=>(n(),a("div",{class:"search-result-item",key:s.id},[L(g(R),{href:l.route("client.products.show",s.url)},{default:x(()=>[N(d(s.title)+" ("+d(s.article)+") ",1)]),_:2},1032,["href"])]))),128)),u.value?(n(),a("div",De,[e("a",{href:"#",onClick:U(ue,["prevent"])},' Все результаты по запросу "'+d(u.value)+'" ',1)])):y("",!0)],544),[[ee,b.value&&m.value.length>0]]),q(e("div",Be,[T.value?(n(),a("div",Qe," Загрузка... ")):(n(),a(C,{key:1},[m.value.length===0&&u.value?(n(),a("div",ze," Ничего не найдено ")):y("",!0)],64))],512),[[ee,b.value]])])]),t[20]||(t[20]=e("div",{class:"col-xl-2 phone__mob__none"},[e("span",null,[e("a",{href:""},"8 (499) 394 38 41")])],-1)),e("div",{class:"nav-item catalog mobile-only",onClick:t[4]||(t[4]=(...s)=>l.toggleMobileCatalog&&l.toggleMobileCatalog(...s))},t[18]||(t[18]=[e("a",{class:"nav-link",href:"#"},"КАТАЛОГ",-1),e("span",null,null,-1)])),l.showMobileCatalog?(n(),a("div",Fe,[e("button",{class:"close-btn",onClick:t[5]||(t[5]=(...s)=>l.toggleMobileCatalog&&l.toggleMobileCatalog(...s))},"Закрыть"),e("ul",Je,[(n(!0),a(C,null,w(i.categories,s=>{var h;return n(),a("li",{key:s.id},[e("div",{class:"category-title",onClick:v=>l.toggleMobileSubcategory(s.id)},d(s.title),9,Ue),l.mobileActiveCategory===s.id&&((h=s.children)!=null&&h.length)?(n(),a("ul",xe,[(n(!0),a(C,null,w(s.children,v=>(n(),a("li",{key:v.id},[e("a",{class:"subcategory-title",href:`/categories/${v.url}/products`,onClick:U(B=>l.toggleMobileSubSubcategory(v.id),["stop"])},d(v.title),9,Re),l.mobileActiveSubcategory===v.id?(n(),a("ul",je,[(n(!0),a(C,null,w(G(v.id),B=>(n(),a("li",{key:B.id},[e("a",{href:`/categories/${B.url}/products`},d(B.title),9,Le)]))),128))])):y("",!0)]))),128))])):y("",!0)])}),128))])])):y("",!0)]),e("div",Ee,[t[30]||(t[30]=e("div",{class:"col-xl-2"},null,-1)),e("div",He,[e("nav",Ge,[e("div",Ke,[e("div",{class:j(["collapse navbar-collapse",{show:f.value}]),id:"navbarNav"},[e("ul",We,[e("li",{class:"nav-item catal catalog__desc",onMouseenter:se,onMouseleave:H},[t[21]||(t[21]=e("a",{class:"nav-link catalog__mar",href:"#"},"КАТАЛОГ",-1)),t[22]||(t[22]=e("span",null,null,-1)),D.value?(n(),a("section",{key:0,class:"catalog_drop",onMouseenter:ne,onMouseleave:H},[e("div",Xe,[e("div",Ye,[(n(!0),a(C,null,w(i.categories,s=>{var h;return n(),a("a",{href:`/categories/${s.url}/products`,class:"item",key:s.id,onMouseenter:v=>ae(s.id)},[e("div",et,[e("div",tt,[e("p",st,d(s.title),1)])]),P.value===s.id&&((h=s.children)!=null&&h.length)?(n(),a("div",{key:0,class:"subcategories",onMouseenter:K},[e("div",lt,[(n(!0),a(C,null,w(s.children,v=>(n(),a("a",{key:v.id,href:`/categories/${v.url}/products`,onMouseenter:B=>oe(v.id)},d(v.title),41,nt))),128))]),$.value?(n(),a("div",{key:0,class:"sub-subcategories",onMouseenter:K},[(n(!0),a(C,null,w(G($.value),v=>(n(),a("div",{key:v.id},[e("a",{href:`/catalog/${v.url}/`},d(v.title),9,at)]))),128))],32)):y("",!0)],32)):y("",!0)],40,Ze)}),128))])])],32)):y("",!0)],32),t[27]||(t[27]=e("li",{class:"nav-item"},[e("a",{class:"nav-link",href:"/portfolio"},"ПОРТФОЛИО")],-1)),e("li",{class:"nav-item drawing-menu",onMouseenter:de,onMouseleave:ve},[t[23]||(t[23]=e("a",{class:"nav-link",href:"#"},"НАНЕСЕНИЕ",-1)),t[24]||(t[24]=e("span",null,null,-1)),M.value?(n(),a("div",ot,[e("div",it,[(n(!0),a(C,null,w(te.value,s=>(n(),fe(g(R),{key:s.id,href:l.route("client.drawing.show",s.url),class:"drawing-dropdown-item"},{default:x(()=>[N(d(s.title),1)]),_:2},1032,["href"]))),128))])])):y("",!0)],32),e("li",rt,[L(g(R),{class:"nav-link",href:l.route("client.contacts.index")},{default:x(()=>t[25]||(t[25]=[N("КОНТАКТЫ")])),_:1,__:[25]},8,["href"])]),t[28]||(t[28]=e("li",{class:"nav-item"},[e("a",{class:"nav-link",href:"/news"},"НОВОСТИ")],-1)),e("li",ut,[L(g(R),{class:"nav-link",href:l.route("client.payment-delivery.index")},{default:x(()=>t[26]||(t[26]=[N("ОПЛАТА И ДОСТАВКА")])),_:1,__:[26]},8,["href"])]),t[29]||(t[29]=Z('<li class="nav-item nav__block__none"><a class="more_menu nav-link" href="#">Преимущества</a></li><li class="nav-item nav__block__none"><a class="more_menu nav-link" href="#">Награды</a></li><li class="nav-item nav__block__none"><a class="more_menu nav-link" href="#">Благодарности</a></li><li class="nav-item nav__block__none"><a class="more_menu nav-link" href="#">Новости</a></li><li class="nav-item nav__block__none"><a class="more_menu nav-link" href="#">Статьи</a></li><li class="nav-item nav__block__none"><a class="more_menu nav-link" href="#">Вопросы и ответы</a></li><li class="nav-item nav__block__none menu__phone"><a class="nav-link" href="#">8 (499) 394 38 41</a></li><li class="nav-item nav__block__none"><a class="nav-link menu__email" href="#">info@mvgifts.ru</a></li>',8))]),e("button",{class:"btn-close d-lg-none ms-auto",type:"button",onClick:I,"aria-controls":"navbarNav","aria-label":"Close"})],2)])])]),t[31]||(t[31]=e("div",{class:"col-xl-2"},null,-1))])]),g(o).isOpen?(n(),a("div",{key:0,class:"cart-popup-overlay",onClick:t[12]||(t[12]=U(s=>g(o).closeCart(),["self"]))},[e("div",ct,[e("div",dt,[t[32]||(t[32]=e("h3",null,"Корзина",-1)),e("button",{class:"close-cart",onClick:t[6]||(t[6]=s=>g(o).closeCart())},"×")]),e("div",vt,[A.value?(n(),a("div",gt,d(A.value),1)):y("",!0),_.value?(n(),a("div",pt,[N(d(_.value)+" ",1),e("button",{class:"error-close",onClick:t[7]||(t[7]=s=>_.value="")},"×")])):y("",!0),g(o).items.length===0?(n(),a("div",_t," Корзина пуста ")):(n(),a("div",mt,[(n(!0),a(C,null,w(g(o).items,(s,h)=>(n(),a("div",{key:h,class:"cart-item"},[e("div",ht,[e("img",{src:s.image,alt:s.title},null,8,ft)]),e("div",bt,[e("h4",null,d(s.title),1),e("p",null,"Цвет: "+d(s.color)+", Размер: "+d(s.size),1),e("p",null,"Артикул: "+d(s.article),1),e("div",yt,[e("div",kt,[e("button",{class:j({"printing-btn":!0,active:!s.withPrinting}),onClick:v=>X(h,!1)}," Без нанесения ",10,Ct),e("button",{class:j({"printing-btn":!0,active:s.withPrinting}),onClick:v=>X(h,!0)}," С нанесением (+ "+d(g(o).printingCost)+" ₽) ",11,wt)])]),e("div",St,d(Y(s))+" ₽ × "+d(s.quantity)+" = "+d(Y(s)*s.quantity)+" ₽ ",1)]),e("div",Mt,[e("div",Pt,[e("button",{onClick:v=>g(o).updateQuantity(h,s.quantity-1)},"-",8,$t),e("span",null,d(s.quantity),1),e("button",{onClick:v=>g(o).updateQuantity(h,s.quantity+1)},"+",8,Tt)]),e("button",{class:"remove-item",onClick:v=>g(o).removeItem(h)},"Удалить",8,qt)])]))),128))]))]),g(o).items.length>0?(n(),a("div",It,[e("form",{onSubmit:U(z,["prevent"]),class:"order-form"},[e("div",At,[t[33]||(t[33]=e("label",{for:"name"},null,-1)),q(e("input",{type:"text",id:"name","onUpdate:modelValue":t[8]||(t[8]=s=>c.name=s),placeholder:"Ваше имя"},null,512),[[J,c.name]])]),e("div",Ot,[t[34]||(t[34]=e("label",{for:"phone"},null,-1)),q(e("input",{type:"tel",id:"phone","onUpdate:modelValue":t[9]||(t[9]=s=>c.phone=s),placeholder:"+7 (999) 999-99-99"},null,512),[[J,c.phone]])]),e("div",Nt,[t[35]||(t[35]=e("label",{for:"email"},null,-1)),q(e("input",{type:"email",id:"email","onUpdate:modelValue":t[10]||(t[10]=s=>c.email=s),placeholder:"your@email.com"},null,512),[[J,c.email]])]),e("div",Vt,[q(e("input",{type:"checkbox",id:"privacy","onUpdate:modelValue":t[11]||(t[11]=s=>c.agreedToPrivacy=s)},null,512),[[he,c.agreedToPrivacy]]),t[36]||(t[36]=e("label",{for:"privacy"},[N(" Я согласен с "),e("a",{style:{"text-decoration":"underline"},href:"/pages/privacy-policy",target:"_blank"}," политикой конфиденциальности")],-1))]),e("div",Dt," Общая сумма: "+d(g(o).totalPrice)+" Р ",1),t[37]||(t[37]=e("button",{type:"submit",class:"btn btn-primary submit-btn btn__red"}," Оформить заказ ",-1))],32)])):y("",!0)])])):y("",!0)]))}});export{zt as _,ye as u};
